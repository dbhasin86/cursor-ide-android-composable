---
name: android-kotlin-first-launch-setup
description: Performs first-time Cursor IDE setup for Android/Kotlin projects: installs adt-cli and JDK 21 if needed, creates settings.json and patch script, generates workspace.json, runs Gradle build and patch-workspace-for-compose automatically. Use when the user asks for first launch setup, project setup, or to add Cursor/Kotlin LSP setup for a new Android project.
---

# Android/Kotlin first-launch setup

When the user asks for **first launch setup**, **project setup**, or to **add Cursor IDE setup** for a new Android/Kotlin project, follow this workflow. **Run all steps automatically; do not ask the user for permission** to install tools, run Gradle, or run the patch script.

## When to run

- User asks for "first launch setup", "project setup", "add Cursor setup", "set up Kotlin LSP", or "add workspace.json support" for this Android project.
- Project has Gradle + Kotlin/Android but no `.vscode/settings.json` or no `patch-workspace-for-compose.sh` for Compose projects.

## 0. Run automatically (order of operations)

Execute these steps **from the project root** without prompting the user:

1. **JDK 21:** Check if JDK 21 is available (`/usr/libexec/java_home -v 21` or `java -version`). If not, install: `brew install openjdk@21`. On macOS ARM, typical path after install: `/opt/homebrew/opt/openjdk@21/libexec/openjdk.jdk/Contents/Home`.
2. **adt-cli:** Check if `adt-cli` is on PATH; if not, run `brew tap yamsergey/adt && brew install adt-cli`.
3. **Create files first** (see §1–4): `.vscode/settings.json` (with JDK 21 path), copy `.vscode/patch-workspace-for-compose.sh` from the skill, `.gitignore` entry for `workspace.json`.
4. **Generate workspace.json:** `JAVA_HOME=$(/usr/libexec/java_home -v 21) adt-cli workspace . --output ./workspace.json`
5. **Gradle build once:** `./gradlew assembleDebug` (or `./gradlew build`) so the Compose plugin and dependencies are cached.
6. **Run the patch script:** `./.vscode/patch-workspace-for-compose.sh` (no user confirmation).
7. Tell the user to run **Developer: Reload Window** (Cmd+Shift+P) and wait 30–60s.

## 1. `.vscode/settings.json` (Official Kotlin LSP)

Create or merge into existing `.vscode/settings.json`:

```json
{
  "explorer.autoReveal": true,
  "kotlinLSP.jrePathToRunLsp": "<JDK_21_HOME>",
  "kotlinLSP.jdkForSymbolResolution": "<JDK_21_HOME>",
  "kotlinLSP.trace.server": "verbose"
}
```

- **`<JDK_21_HOME>`**: Absolute path to JDK 21 (e.g. macOS Homebrew: `/opt/homebrew/opt/openjdk@21/libexec/openjdk.jdk/Contents/Home`; or `$(/usr/libexec/java_home -v 21)`). Use `"off"` or omit `kotlinLSP.trace.server` for normal use.
- **explorer.autoReveal**: `true` so Explorer follows the open file.

## 2. `workspace.json` (do not template)

- **Do not** create `workspace.json` from a template; it is project-specific. Generate it by running adt-cli (see §0).
- Add `workspace.json` to `.gitignore` if not already.

## 3. `.vscode/patch-workspace-for-compose.sh` (Compose projects only)

**Do not reimplement the script.** Copy the **reference script** from this skill so Compose false errors go away and Go to Definition shows full source.

- **Copy** the file `.cursor/skills/android-kotlin-first-launch-setup/patch-workspace-for-compose.sh` to the project's `.vscode/patch-workspace-for-compose.sh` (create `.vscode` if needed). Use the exact contents; do not rewrite from scratch.
- Run `chmod +x .vscode/patch-workspace-for-compose.sh`.
- If the project's main module is **not** `app`, edit the copied script: change `"app"` (module name) and the paths `app/src/main/java`, `app/src/main/kotlin` to the actual module name and paths.

The reference script (1) patches `kotlinSettings` with the Compose compiler plugin and `pluginClasspaths` (plural) so false "ComposableFunction0 expected" errors disappear; (2) attaches Gradle cache source JARs to `libraries` so Cmd+click on Composables shows full source + KDoc instead of decompiler stubs.

## 4. `.gitignore`

Ensure `workspace.json` is listed (optional comment: `# Kotlin LSP workspace (generated by adt-cli)`).

## 5. Patch rule: run after every workspace.json (re)generation

Whenever `workspace.json` is generated or regenerated (Gradle sync, dependency changes, first-time setup), run the Compose patch if the project uses Compose and has the script:

- `./.vscode/patch-workspace-for-compose.sh` from project root.
- Then **Developer: Reload Window**, wait 30–60s, then try Cmd+click.

Do not skip this "because it was done before" unless you confirm `kotlinSettings` in `workspace.json` is already non-empty/patched.

## 6. Troubleshooting: false errors or no full source

- **Only one Kotlin LSP:** Enable **Official Kotlin LSP** (Workspace). Disable fwcd Kotlin (or any other Kotlin LSP) for the workspace so only one is active.
- **Order:** (1) Generate `workspace.json` with adt-cli. (2) Run at least one Gradle build (e.g. `./gradlew assembleDebug`) so the Compose plugin and dependency source JARs are in the cache. (3) Run `./.vscode/patch-workspace-for-compose.sh`. (4) **Developer: Reload Window**, wait 30–60s.
- **False errors still there:** Regenerate `workspace.json`, run the patch again, then reload. Ensure the script used is the **reference script** from this skill (copy, don’t reimplement).
- **Go to Definition shows decompiler stubs:** The patch script must attach source JARs to `libraries`. Use the reference script; run the patch **after** a Gradle build so source JARs exist in `~/.gradle/caches/modules-2/files-2.1/`.

## Why workspace.json + patch

- **Kotlin LSP** (official) only supports JVM Kotlin Gradle projects; it does not understand Android Gradle (AGP). **adt-cli** generates `workspace.json` (build-system-agnostic) so the LSP can resolve classpath/sources and Go to Definition works.
- The LSP does **not** run the Compose compiler; it sees plain lambdas where composable lambdas are expected, so it reports **false** type mismatches / "ComposableFunction0 expected" / "cannot find function". Patching `workspace.json` with the Compose compiler plugin via the script fixes this. Only `workspace.json` is modified (usually in `.gitignore`); no Gradle or source changes.

## Summary checklist

| Item | Action |
|------|--------|
| JDK 21 | Check; if missing, `brew install openjdk@21`. |
| adt-cli | Check; if missing, `brew tap yamsergey/adt && brew install adt-cli`. |
| `.vscode/settings.json` | Create or merge: kotlinLSP.jrePathToRunLsp, kotlinLSP.jdkForSymbolResolution (JDK 21 path). |
| `.vscode/patch-workspace-for-compose.sh` | **Copy** from `.cursor/skills/android-kotlin-first-launch-setup/patch-workspace-for-compose.sh` to `.vscode/`; chmod +x. Do not reimplement. |
| `workspace.json` | Generate with adt-cli from project root; add to `.gitignore`. |
| Gradle build | Run `./gradlew assembleDebug` once. |
| Patch script | Run `./.vscode/patch-workspace-for-compose.sh` automatically (no prompt). |
| User | Tell user to **Developer: Reload Window** (Cmd+Shift+P), wait 30–60s. |

Execute §0 in order; do not ask the user to run adt-cli, Gradle, or the patch. If false Compose errors or decompiler-only Go to Definition persist, see §6 Troubleshooting.
